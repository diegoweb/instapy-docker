FROM balenalib/raspberrypi3-ubuntu-python:3-latest-build

RUN [ "cross-build-start" ]

WORKDIR /code
ARG LAUNCHPAD_URL=http://launchpadlibrarian.net/
ARG LAUNCHPAD_VERSION=361669488
ARG LAUNCHPAD_PACKAGE=chromium-chromedriver_65.0.3325.181-0ubuntu0.14.04.1_armhf.deb

RUN apt-get update \
    && apt-get install -y --no-install-recommends --no-install-suggests \
      g++ \
	  chromium-browser	

RUN wget $LAUNCHPAD_URL/$LAUNCHPAD_VERSION/$LAUNCHPAD_PACKAGE && \
    dpkg -i $LAUNCHPAD_PACKAGE && \
    rm $LAUNCHPAD_PACKAGE
      
RUN wget -O '/tmp/requirements.txt' https://raw.githubusercontent.com/InstaPy/instapy-docker/master/requirements.txt \
	&& pip3 install --upgrade setuptools \
    && pip3 install --ignore-installed jsonschema==2.6.0 six \
    && pip3 install --no-cache-dir -U -r /tmp/requirements.txt
    
RUN apt-get purge -y --auto-remove \
      gcc \
      g++ \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/requirements.txt

CMD ["python", "docker_quickstart.py"]
RUN [ "cross-build-end" ]
